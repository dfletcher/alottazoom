(function(g){g.easing.alottaZoomZoom=function(m,n,l,p,o){return 1-((1-m)*(1-m))};function i(n,v,u,t,m,s,o){var A=t*n.source.width;if(A<=n.width){v=0.5*(n.width-A)}else{var r=-1*(A-n.width);if(v<r){v=r}else{if(v>0){v=0}}}var p=t*n.source.height;if(p<=n.height){u=0.5*(n.height-p)}else{var r=-1*(p-n.height);if(u<r){u=r}else{if(u>0){u=0}}}n.state.x=v;n.state.y=u;n.state.z=t;var D=(n._hw-v)/t;var C=(n._hh-u)/t;var l=[n.source.width*n.source.width,null];g(".marker",n.$alottazoom).each(function(){var K=g(this);var y=K.width();var H=K.height();var x=(parseInt(K.data("x"),10)*t)-(0.5*y);var w=(parseInt(K.data("y"),10)*t)-(0.5*H);var G=n.state.x+x;var z=(-1*p)+u+w;var L=D-x;var J=C-w;var F=(L*L)+(J*J);var I=w+u;console.log(I);if((F<l[0])&&(x>0)&&(x<n.width)&&(I>0)&&(I<n.height)){l[0]=F;l[1]=K}var E={left:G+"px",top:z+"px"};if(m){K.stop().animate(E,o,s)}else{K.css(E)}});var B=g(".marker.active",n.$alottazoom);if(l[1]){if(!l[1].hasClass("active")){l[1].addClass("active");if(B.length){B.removeClass("active");if(typeof(n.marker_deactivate_callback)=="function"){n.marker_deactivate_callback(n.$alottazoom,B)}}if(typeof(n.marker_activate_callback)=="function"){n.marker_activate_callback(n.$alottazoom,l[1])}}}else{if(B.length){B.removeClass("active");if(typeof(n.marker_deactivate_callback)=="function"){n.marker_deactivate_callback(n.$alottazoom,B)}}}var q={width:A+"px",left:v+"px",top:u+"px"};if(m){n.$image.stop().animate(q,o,s)}else{n.$image.css(q)}}function k(n,l,o){var m=(typeof(arguments[3])!="undefined")?arguments[3]:true;i(n,l,o,n.state.z,m,n.move_easing,n.move_duration)}function j(n,l,o){var m=(typeof(arguments[3])!="undefined")?arguments[3]:true;k(n,n.state.x+l,n.state.y+o,m)}function a(p,l,q){var o=(typeof(arguments[3])!="undefined")?arguments[3]:true;var n=-1*(l*p.state.z)+p._hw;var m=-1*(q*p.state.z)+p._hh;k(p,n,m,o)}function f(p,r){var q=p._zoomscalar*r;if(q<p.min_zoom){r=p.min_zoom/p._zoomscalar}else{if(q>p.max_zoom){r=p.max_zoom/p._zoomscalar}}var m=(((p.state.x-p._hw)/p.state.z)*r)+p._hw;var o=(((p.state.y-p._hh)/p.state.z)*r)+p._hh;var n=(typeof(arguments[2])!="undefined")?arguments[2]:true;i(p,m,o,r,n,p.zoom_easing,p.zoom_duration)}function c(m,n){var l=(typeof(arguments[2])!="undefined")?arguments[2]:true;f(m,m.state.z+n,l)}function h(o,m){var p=o.width/o.source.width;var n=o.source.height*p;var l,s,q;if(((o.zoom=="fill")&&(n>o.height))||((o.zoom=="fit")&&(n<o.height))){q=p;l=0;s=(o.height-n)/2}else{if((o.zoom=="fit")||(o.zoom=="fill")){q=o.height/o.source.height;l=(o.width-(q*o.source.width))/2;s=0}else{if(typeof(o.zoom)=="number"){l=o.x;s=o.y;q=o.zoom}else{l=0;s=0;q=1}}}o._zoomscalar=1/q;i(o,l,s,q,m,o.reset_easing,o.reset_duration)}function d(m,n,l){if(m._drag){n.preventDefault();g(window).unbind("mousemove");m._drag=false}else{if(l){}}}function e(m){var l=g(m.delegateTarget).data("alottazoom");if(l){d(l,m,true)}else{g(".alottazoom-wrapper").each(function(){var n=g(this).data("alottazoom");if(n){d(n,m,false)}})}}var b={reset:function(l){h(l,true)},"goto":function(l){f(l,arguments[3]);a(l,arguments[1],arguments[2])},shift:function(l){j(l,arguments[1],arguments[2])}};g.fn.alottazoom=function(m){var o=this;var n=o.data("alottazoom");if(n){var l=typeof(m);if(l=="object"){}else{if(l=="string"){if(typeof(b[m])=="function"){b[m](n,arguments[1],arguments[2],arguments[3])}}}}else{n=g.extend({width:this.width(),height:this.height(),$image:g("IMG",this),$alottazoom:this,zoom:"fit",x:0,y:0,min_zoom:1,max_zoom:6,zoom_speed:6,drag_speed:0.68,move_easing:"alottaZoomZoom",move_duration:750,zoom_easing:"alottaZoomZoom",zoom_duration:550,reset_easing:"alottaZoomZoom",reset_duration:550,marker_activate_callback:null,marker_deactivate_callback:null},m);o.addClass("alottazoom-wrapper-loading").data("alottazoom",n);n.$image.addClass("alottazoom-image-loading").load(function(){o.removeClass("alottazoom-wrapper-loading").addClass("alottazoom-wrapper");n.$image.removeClass("alottazoom-image-loading").addClass("alottazoom-image");n.source={width:n.$image.width(),height:n.$image.height()};n.mouse={x:0,y:0};n.state={x:0,y:0,z:0};n._drag=false;n._hw=0.5*n.width;n._hh=0.5*n.height;n._mv={x:0,y:0};h(n,false);o.mouseup(e).bind("DOMMouseScroll mousewheel",function(p){p.preventDefault();c(n,-1*(p.originalEvent.detail?p.originalEvent.detail:(p.originalEvent.wheelDelta/-40))*n.zoom_speed/100)}).mousedown(function(p){p.preventDefault();n.mouse.x=p.pageX;n.mouse.y=p.pageY;n._mv.x=p.pageX;n._mv.y=p.pageX;g(window).mousemove(function(v){v.preventDefault();n._drag=true;var s=v.pageX-n.mouse.x;var r=v.pageY-n.mouse.y;var q=n.state.x+(s*n.drag_speed);var u=n.state.y+(r*n.drag_speed);k(n,q,u,false);n.mouse.x=v.pageX;n.mouse.y=v.pageY})});g(window).mouseup(e).resize(function(p){g(".alottazoom-wrapper").each(function(){var r=g(this);var q=r.data("alottazoom");q.width=r.width();q.height=r.height();q._hw=0.5*q.width;q._hh=0.5*q.height})})})}return this}}(jQuery));